# âœ… é‚®ç®±éªŒè¯å¼ºåˆ¶ç™»å½•åŠŸèƒ½

## ğŸ“‹ åŠŸèƒ½è¯´æ˜

ç°åœ¨ç™»å½•ç³»ç»Ÿ**å¼ºåˆ¶è¦æ±‚é‚®ç®±éªŒè¯**ï¼ŒæœªéªŒè¯é‚®ç®±çš„ç”¨æˆ·æ— æ³•ç™»å½•ã€‚

## ğŸ” å®ç°é€»è¾‘

### 1. ç™»å½•æµç¨‹

```
ç”¨æˆ·è¾“å…¥é‚®ç®±å¯†ç  â†’ ç‚¹å‡»ç™»å½•
        â†“
Firebase Auth è®¤è¯æˆåŠŸ
        â†“
æ£€æŸ¥é‚®ç®±æ˜¯å¦å·²éªŒè¯ï¼Ÿ
        â”œâ”€ âœ… å·²éªŒè¯
        â”‚     â†’ åˆ›å»º/è¯»å– Firestore ç”¨æˆ·æ–‡æ¡£
        â”‚     â†’ è·³è½¬åˆ°ä¸»é¡µ
        â”‚
        â””â”€ âŒ æœªéªŒè¯
              â†’ ç«‹å³ç™»å‡ºç”¨æˆ·ï¼ˆauthRepository.logout()ï¼‰
              â†’ æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
              â†’ æ˜¾ç¤º"é‡æ–°å‘é€éªŒè¯é‚®ä»¶"æŒ‰é’®
```

### 2. å…³é”®ä»£ç ä¿®æ”¹

#### LoginViewModel.kt

```kotlin
fun login(role: UserRole) {
    val result = loginUseCase(email, password)
    
    if (result.isSuccess) {
        val isVerified = authRepository.isEmailVerified()
        
        if (!isVerified) {
            // ğŸ”’ å…³é”®ï¼šé‚®ç®±æœªéªŒè¯ï¼Œç«‹å³ç™»å‡º
            authRepository.logout()
            
            _uiState.update {
                it.copy(
                    isLoading = false,
                    isSuccess = false,
                    showResendVerification = true,  // æ˜¾ç¤ºé‡å‘æŒ‰é’®
                    error = "Email not verified. Please check your inbox..."
                )
            }
        } else {
            // âœ… éªŒè¯é€šè¿‡ï¼Œå…è®¸ç™»å½•
            _uiState.update {
                it.copy(isLoading = false, isSuccess = true)
            }
        }
    }
}
```

#### æ–°å¢åŠŸèƒ½ï¼šé‡æ–°å‘é€éªŒè¯é‚®ä»¶

```kotlin
fun resendVerificationEmail() {
    // 1. ä¸´æ—¶ç™»å½•
    val loginResult = loginUseCase(email, password)
    
    if (loginResult.isSuccess) {
        // 2. å‘é€éªŒè¯é‚®ä»¶
        val result = authRepository.sendEmailVerification()
        
        // 3. ç«‹å³ç™»å‡º
        authRepository.logout()
        
        // 4. æ˜¾ç¤ºç»“æœ
        if (result.isSuccess) {
            showMessage("Verification email sent! Check your inbox.")
        }
    }
}
```

### 3. UI æ›´æ–°

#### LoginScreen.kt

æ–°å¢"é‡æ–°å‘é€éªŒè¯é‚®ä»¶"æŒ‰é’®ï¼š

```kotlin
if (uiState.showResendVerification) {
    OutlinedButton(
        onClick = onResendVerification,
        // ... æ ·å¼é…ç½®
    ) {
        Icon(Icons.Default.Email)
        Text("Resend Verification Email")
    }
}
```

## ğŸ¯ ç”¨æˆ·ä½“éªŒæµç¨‹

### åœºæ™¯ 1: å·²éªŒè¯ç”¨æˆ·ç™»å½•

```
1. è¾“å…¥é‚®ç®±å¯†ç 
2. ç‚¹å‡» Login
3. âœ… éªŒè¯æ£€æŸ¥é€šè¿‡
4. â†’ è·³è½¬åˆ°ä¸»é¡µ
```

### åœºæ™¯ 2: æœªéªŒè¯ç”¨æˆ·å°è¯•ç™»å½•

```
1. è¾“å…¥é‚®ç®±å¯†ç 
2. ç‚¹å‡» Login
3. âŒ éªŒè¯æ£€æŸ¥å¤±è´¥
4. æ˜¾ç¤ºé”™è¯¯: "Email not verified. Please check your inbox..."
5. æ˜¾ç¤ºæŒ‰é’®: "Resend Verification Email"
6. ç”¨æˆ·è¢«è‡ªåŠ¨ç™»å‡ºï¼ˆå®‰å…¨æªæ–½ï¼‰
```

### åœºæ™¯ 3: é‡æ–°å‘é€éªŒè¯é‚®ä»¶

```
1. ç‚¹å‡» "Resend Verification Email"
2. ç³»ç»Ÿä¸´æ—¶ç™»å½• â†’ å‘é€é‚®ä»¶ â†’ ç«‹å³ç™»å‡º
3. æ˜¾ç¤ºæ¶ˆæ¯: "Verification email sent! Check your inbox."
4. ç”¨æˆ·æ‰“å¼€é‚®ç®± â†’ ç‚¹å‡»éªŒè¯é“¾æ¥
5. è¿”å› App â†’ é‡æ–°ç™»å½• â†’ âœ… æˆåŠŸ
```

## ğŸ”’ å®‰å…¨ç‰¹æ€§

1. **å¼ºåˆ¶éªŒè¯**ï¼šæœªéªŒè¯é‚®ç®±æ— æ³•ä½¿ç”¨ç³»ç»Ÿ
2. **è‡ªåŠ¨ç™»å‡º**ï¼šéªŒè¯å¤±è´¥ç«‹å³ç™»å‡ºï¼Œé˜²æ­¢ç»•è¿‡
3. **ä¸´æ—¶ä¼šè¯**ï¼šé‡å‘é‚®ä»¶æ—¶çš„ç™»å½•ä¼šè¯ç«‹å³é”€æ¯
4. **å‹å¥½æç¤º**ï¼šæ¸…æ™°çš„é”™è¯¯æ¶ˆæ¯å’Œæ“ä½œæŒ‡å¼•

## ğŸ“± UI å˜åŒ–

### LoginUiState æ–°å¢å­—æ®µ

```kotlin
data class LoginUiState(
    // ... å…¶ä»–å­—æ®µ
    val showResendVerification: Boolean = false  // æ§åˆ¶æŒ‰é’®æ˜¾ç¤º
)
```

### æŒ‰é’®æ ·å¼

- **ä½ç½®**ï¼šç™»å½•æŒ‰é’®ä¸‹æ–¹
- **æ ·å¼**ï¼šOutlinedButtonï¼ˆè½®å»“æŒ‰é’®ï¼‰
- **é¢œè‰²**ï¼šä¸ä¸»é¢˜è‰²ä¸€è‡´ï¼ˆè“è‰²/ç´«è‰²ï¼‰
- **å›¾æ ‡**ï¼šEmail å›¾æ ‡
- **æ–‡å­—**ï¼š"Resend Verification Email"

## ğŸ§ª æµ‹è¯•æ­¥éª¤

### æµ‹è¯• 1: éªŒè¯å¼ºåˆ¶è¦æ±‚

1. æ³¨å†Œæ–°ç”¨æˆ·ï¼ˆä¸éªŒè¯é‚®ç®±ï¼‰
2. å°è¯•ç™»å½•
3. **é¢„æœŸç»“æœ**ï¼š
   - âŒ ç™»å½•å¤±è´¥
   - æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
   - æ˜¾ç¤º"é‡å‘éªŒè¯é‚®ä»¶"æŒ‰é’®

### æµ‹è¯• 2: é‡å‘éªŒè¯é‚®ä»¶

1. æœªéªŒè¯ç”¨æˆ·ç™»å½•å¤±è´¥å
2. ç‚¹å‡»"Resend Verification Email"
3. **é¢„æœŸç»“æœ**ï¼š
   - âœ… æ”¶åˆ°æ–°çš„éªŒè¯é‚®ä»¶
   - æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯

### æµ‹è¯• 3: éªŒè¯åç™»å½•

1. ç‚¹å‡»é‚®ä»¶ä¸­çš„éªŒè¯é“¾æ¥
2. è¿”å› App é‡æ–°ç™»å½•
3. **é¢„æœŸç»“æœ**ï¼š
   - âœ… ç™»å½•æˆåŠŸ
   - è·³è½¬åˆ°ä¸»é¡µ
   - æ˜¾ç¤ºçœŸå®ç”¨æˆ·å

### æµ‹è¯• 4: å·²éªŒè¯ç”¨æˆ·

1. ä½¿ç”¨å·²éªŒè¯é‚®ç®±ç™»å½•
2. **é¢„æœŸç»“æœ**ï¼š
   - âœ… ç›´æ¥ç™»å½•æˆåŠŸ
   - ä¸æ˜¾ç¤º"é‡å‘"æŒ‰é’®

## ğŸ“Š æ•°æ®æµ

```
AuthRepository.login()
    â†“
FirebaseAuth.signInWithEmailAndPassword()
    â†“
AuthRepository.isEmailVerified()
    â†“
firebaseAuth.currentUser?.reload()  // åˆ·æ–°çŠ¶æ€
    â†“
firebaseAuth.currentUser?.isEmailVerified
    â†“
true  â†’ ç»§ç»­ç™»å½•æµç¨‹
false â†’ authRepository.logout() â†’ æ˜¾ç¤ºé”™è¯¯
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **éªŒè¯çŠ¶æ€ç¼“å­˜**ï¼šè°ƒç”¨ `reload()` ç¡®ä¿è·å–æœ€æ–°éªŒè¯çŠ¶æ€
2. **è‡ªåŠ¨ç™»å‡º**ï¼šéªŒè¯å¤±è´¥åå¿…é¡»ç™»å‡ºï¼Œé˜²æ­¢å®‰å…¨æ¼æ´
3. **é‡å‘é¢‘ç‡**ï¼šFirebase å¯¹é‚®ä»¶å‘é€æœ‰é¢‘ç‡é™åˆ¶
4. **é”™è¯¯å¤„ç†**ï¼šç½‘ç»œé”™è¯¯æ—¶ç»™å‡ºå‹å¥½æç¤º

## ğŸ¨ UI ç¤ºä¾‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     [â† Back]                 â”‚
â”‚                              â”‚
â”‚      ğŸ‘¤ User Icon            â”‚
â”‚                              â”‚
â”‚      Senior Login            â”‚
â”‚      Welcome Back            â”‚
â”‚                              â”‚
â”‚  Email: ___________________  â”‚
â”‚  Password: ________________ â”‚
â”‚  â˜‘ Agree to Terms           â”‚
â”‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚       Login          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â† ä»…åœ¨éªŒè¯å¤±è´¥æ—¶æ˜¾ç¤º
â”‚  â”‚ ğŸ“§ Resend Verificationâ”‚   â”‚
â”‚  â”‚      Email           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚
â”‚  No account? Register        â”‚
â”‚                              â”‚
â”‚  Forgot Password?            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

ç°åœ¨ç™»å½•ç³»ç»Ÿå®Œå…¨å¼ºåˆ¶é‚®ç®±éªŒè¯ï¼Œç¡®ä¿åªæœ‰éªŒè¯ç”¨æˆ·æ‰èƒ½è®¿é—®ï¼ğŸ”
